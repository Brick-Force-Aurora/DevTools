<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BrickForceDevTools.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:views="clr-namespace:BrickForceDevTools.Views"
		xmlns:conv="clr-namespace:BrickForceDevTools.Converters"
        mc:Ignorable="d" d:DesignWidth="1366" d:DesignHeight="768"
        x:Class="BrickForceDevTools.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/bf-logo.ico"
        Title="Brick-Force Dev Tools"
		ExtendClientAreaToDecorationsHint="True"
		MinHeight="800"
		MinWidth="1200"
		Background="#222222">
	<Window.Styles>
		<Style Selector="TabControl WrapPanel">
			<Setter Property="Background" Value="#3b3b3b"/>
		</Style>
	</Window.Styles>
	<Window.Resources>
		<conv:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
	</Window.Resources>
    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>
	<Grid RowDefinitions="*, Auto" Margin="0,30,0,0">
	<Image Source="/Assets/bf-logo.ico" Stretch="Uniform" Width="20" Height="20" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5,-25,0,0"/>
	<TextBlock Text="Brick-Force Dev Tools" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="30,-24,0,0"></TextBlock>
	<TabControl>
		<TabItem Header="Map Unpacker" VerticalContentAlignment="Center">
		<Grid RowDefinitions="Auto, *" Margin="10">
			<!-- Menu Bar -->
			<Grid ColumnDefinitions="Auto,* ,Auto" VerticalAlignment="Center">
			<!-- Left buttons -->
			<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="5">
				<Button x:Name="BtnLoadFile" Content="Open File" Click="OnLoadFileClick"/>
				<Button x:Name="BtnLoadFolder" Content="Open Folder" Click="OnLoadFolderClick"/>
			</StackPanel>

			<!-- Right counter -->
			<TextBlock x:Name="TxtRegMapCount"
               Grid.Column="2"
               VerticalAlignment="Center"
               HorizontalAlignment="Right"
               Text="Loaded: 0"/>
			</Grid>


			<!-- Main Content Area -->
					<Grid ColumnDefinitions="3*, 2*, 1*" Row="1" Margin="0,10,0,10">
						<!-- Left: Placeholder for TreeDataGrid -->
						<DataGrid Margin="0,0,10,0"
							ItemsSource="{Binding RegMapsViewModel.RegMaps, Mode=TwoWay}"
							SelectedItem="{Binding SelectedRegMap, Mode=TwoWay}"
							IsReadOnly="True"
							CanUserReorderColumns="True"
							CanUserResizeColumns="True"
							CanUserSortColumns="True"
							GridLinesVisibility="All"
							BorderThickness="1" BorderBrush="Gray"
							SelectionChanged="OnRegMapSelected">
							<DataGrid.Columns>
								<DataGridTextColumn Header="Name"  Binding="{Binding alias}"/>
								<DataGridTextColumn Header="Map ID"  Binding="{Binding map}"/>
								<DataGridTextColumn Header="Bricks"  Binding="{Binding geometry.brickCount}"/>
								<DataGridTextColumn Header="Creator" Binding="{Binding developer}" />
							</DataGrid.Columns>
						</DataGrid>

						<!-- Middle: Input Fields -->
						<StackPanel Grid.Column="1" Spacing="5" Margin="0,0,10,0">
							<TextBox x:Name="TxtName" Watermark="Map Name" Text="{Binding RegMapsViewModel.MapName, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBox x:Name="TxtMapId" Watermark="Map ID" Text="{Binding RegMapsViewModel.MapId, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBox x:Name="TxtCreator" Watermark="Creator" Text="{Binding RegMapsViewModel.Creator, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBox x:Name="TxtDate" Watermark="Date" Text="{Binding RegMapsViewModel.Date}" IsReadOnly="True"/>
							<TextBox x:Name="TxtBrickCount" Watermark="Brick Count" IsReadOnly="True" Text="{Binding RegMapsViewModel.BrickCount}"/>
							<!-- Modes (icon toggles) -->
							<ItemsControl ItemsSource="{Binding RegMapsViewModel.ModeToggles}">
							    <ItemsControl.ItemsPanel>
							        <ItemsPanelTemplate>
							            <StackPanel Orientation="Horizontal" Spacing="6"/>
							        </ItemsPanelTemplate>
							    </ItemsControl.ItemsPanel>
							
							    <ItemsControl.ItemTemplate>
							        <DataTemplate>
							            <ToggleButton IsChecked="{Binding IsActive}"
							                          ToolTip.Tip="{Binding Name}"
							                          Width="42" Height="28"
							                          Padding="0">
							                <Image Width="42" Height="24"
							                       Source="{Binding Icon}"
							                       Opacity="{Binding IsActive, Converter={StaticResource BoolToOpacityConverter}}"/>
							            </ToggleButton>
							        </DataTemplate>
							    </ItemsControl.ItemTemplate>
							</ItemsControl>
							<CheckBox x:Name="ChkOfficial" Content="Official" IsChecked="{Binding RegMapsViewModel.IsOfficial}"/>
							<CheckBox x:Name="ChkClan" Content="Clan" IsChecked="{Binding RegMapsViewModel.IsClan}"/>
						</StackPanel>

						<!-- Right: Thumbnail and Export Button -->
						<StackPanel Grid.Column="2" Spacing="10">
							<Image Source="{Binding RegMapsViewModel.Thumbnail}" Stretch="Uniform" Width="200" Height="200"/>
							<Button x:Name="BtnExportAll" Height="50" Width="200" HorizontalAlignment="Center" Click="OnExportAllClick">
								<TextBlock Text="Export" VerticalAlignment="Center" HorizontalAlignment="Center"/>
							</Button>
						</StackPanel>
					</Grid>
				</Grid>
			</TabItem>
			<TabItem Header="Template Uncooker" VerticalContentAlignment="Center">
				<Grid RowDefinitions="Auto, *" Margin="10">
					<!-- Menu Bar -->
					<StackPanel Orientation="Horizontal" Spacing="5">
						<Button x:Name="BtnLoadCooker" Content="Open Folder" Click="LoadFiles"/>
						<Button x:Name="BtnSaveCooked" Content="Cook" Click="SaveCookedFile"/>
						<Button x:Name="BtnSaveUncooked" Content="Uncook" Click="SaveUncookedFile"/>
					</StackPanel>

					<!-- Main Content Area -->
					<Grid ColumnDefinitions="2*, 3*" Row="1" Margin="0,10,0,10">
						<!-- Left: Placeholder for TreeDataGrid -->
						<DataGrid Margin="0,0,10,0"
							ItemsSource="{Binding RegMapsViewModel.TemplateFiles, Mode=TwoWay}"
							SelectedItem="{Binding SelectedTemplateFile, Mode=TwoWay}"
							IsReadOnly="True"
							CanUserReorderColumns="True"
							CanUserResizeColumns="True"
							CanUserSortColumns="True"
							GridLinesVisibility="All"
							BorderThickness="1" BorderBrush="Gray"
							SelectionChanged="OnTemplateFileSelected">
							<DataGrid.Columns>
								<DataGridTextColumn Header="File Name"  Binding="{Binding FileName}"/>
								<DataGridTextColumn Header="File Type"  Binding="{Binding FileType}"/>
							</DataGrid.Columns>
						</DataGrid>
						<StackPanel Orientation="Vertical" Spacing="5" Grid.Column="1">
							<TextBlock FontSize="16" Text="Preview:"/>
							<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
								<TextBlock x:Name="CookPreview"
										   TextWrapping="Wrap"
										   FontFamily="Courier New"
										   FontSize="12"
										   Text="{Binding PreviewText}"/>
							</ScrollViewer>
						</StackPanel>
					</Grid>
				</Grid>
			</TabItem>
		<TabItem Header="Patch Builder">
		    <StackPanel Margin="12" Spacing="10">
		
		        <TextBlock Text="{Binding PatchBuilder.Summary}" />
		
		        <StackPanel Orientation="Horizontal" Spacing="8">
		            <Button Content="Select Folder A then B" Click="OnSelectFoldersForPatchClick"/>
		            <Button x:Name="BtnBuildPatch" Content="Build Patch" Click="OnBuildPatchClick"
		                    IsEnabled="{Binding PatchBuilder.CanBuildPatch}" />
		        </StackPanel>
		
		        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto">
		            <TextBlock Grid.Row="0" Grid.Column="0" Text="Folder A:" Margin="0,0,8,0"/>
		            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding PatchBuilder.FolderA}" />
		
		            <TextBlock Grid.Row="1" Grid.Column="0" Text="Folder B:" Margin="0,0,8,0"/>
		            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PatchBuilder.FolderB}" />
		
		            <TextBlock Grid.Row="2" Grid.ColumnSpan="2" Text="Diff (B ? A):" Margin="0,8,0,0"/>
		        </Grid>
		
		        <DataGrid ItemsSource="{Binding PatchBuilder.DiffItems}"
		                  AutoGenerateColumns="False"
		                  IsReadOnly="True"
		                  Height="340">
		            <DataGrid.Columns>
		                <DataGridTextColumn Header="Base" Binding="{Binding BaseName}" Width="1.5*"/>
		                <DataGridTextColumn Header="MapName" Binding="{Binding MapName}" Width="2*"/>
		                <DataGridTextColumn Header="Creator" Binding="{Binding Creator}" Width="2*"/>
		                <DataGridCheckBoxColumn Header=".geometry" Binding="{Binding HasGeometry}" Width="*"/>
		                <DataGridTextColumn Header="RegMap" Binding="{Binding RegMapFile}" Width="2*"/>
		                <DataGridTextColumn Header="Geometry" Binding="{Binding GeometryFile}" Width="2*"/>
		            </DataGrid.Columns>
		        </DataGrid>
		
		    </StackPanel>
		</TabItem>

		<TabItem Header="Settings" VerticalContentAlignment="Center">
			<Grid RowDefinitions="Auto, *" Margin="10">
				<StackPanel Orientation="Horizontal" Spacing="5">
					<Button Grid.Row="0" Content="Apply" HorizontalAlignment="Left" Click="OnSaveClick"/>
					<Button Content="Clear Folders" Click="OnClearFoldersClick"/>
				</StackPanel>
				<!-- Main Content -->
				<StackPanel Grid.Row="1" Spacing="5" Margin="0,10,0,0">
					<CheckBox Content="Skip Missing Geometry" IsChecked="{Binding SkipMissingGeometry}" />
					<CheckBox Content="Default Export All" IsChecked="{Binding DefaultExportAll}" />
					<CheckBox Content="Default Export .regmap" IsChecked="{Binding DefaultExportRegMap}" />
					<CheckBox Content="Default Export .geometry" IsChecked="{Binding DefaultExportGeometry}" />
					<CheckBox Content="Default Export JSON" IsChecked="{Binding DefaultExportJson}" />
					<CheckBox Content="Default Export OBJ" IsChecked="{Binding DefaultExportObj}" />
					<CheckBox Content="Default Export Plaintext" IsChecked="{Binding DefaultExportPlaintext}" />
					<CheckBox Content="Include Assembly-CSharp.dll in patch info" IsChecked="{Binding IncludeAssemblyLineInPatchInfo}" />
					<TextBlock Margin="0 5" >Default Export Location:</TextBlock>
					<StackPanel Orientation="Horizontal" Spacing="8">
						<TextBox Width="600"
								 Watermark="Export Folder"
								 Text="{Binding DefaultExportLocation, UpdateSourceTrigger=PropertyChanged}" />
						<Button Content="Browse..." Command="{Binding BrowseExportLocationCommand}" />
					</StackPanel>
				</StackPanel>			
			</Grid>
		</TabItem>
		</TabControl>
	<!-- Log Expander spanning the full width -->
	<Expander x:Name="LogExpander"  Margin="10" Header="Log" IsExpanded="True" Grid.Row="1" HorizontalAlignment="Stretch">
		<ScrollViewer x:Name="LogScrollViewer" VerticalScrollBarVisibility="Auto" MaxHeight="300">
			<TextBlock x:Name="LogTextBlock" TextWrapping="Wrap"
					   FontFamily="Courier New" FontSize="12" />
		</ScrollViewer>
	</Expander>
	</Grid>
</Window>
